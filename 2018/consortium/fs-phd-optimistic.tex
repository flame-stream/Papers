%%% fs-phd-optimistic - Optimistic low-level consistency
\label{fs-phd-optimistic}

In some cases high-level consistency cannot be implemented without low-level guarantees. For example, if user-defined consistency is based on some metric, system must ensure that the values of this metric are reliable, not lost, and do not contain duplicates. Therefore, there is a need for exactly-once semantics. However, as it was mentioned above, all existing methods for achieving exactly-once provide high overhead that makes them not suitable for performance-sensitive scenarios.

We propose a novel technique for achieving exactly-once. We introduce a deterministic model that is based on low-overhead optimistic approach for handling out-of-order items~\cite{we2018seim}. Determinism implies that if we assign monotonic logical timestamps to input data items at system's entry, the order of output items will be monotonic regarding the timestamps too. The property of determinism is converted to idempotence by simple deduplication mechanism that maintains the timestamp of the last released item and filters out all items with less timestamp. In~\cite{we2018beyondmr} we show that such approach is able to significantly outperform alternative solutions in terms of latency.

The central idea behind our extremely low-overhead method for achieving exactly-once is the optimistic model that guarantees that the order between input and output items is preserved in spite of non-deterministic nature of the distributed systems. There are several existing techniques for ordering, but they require extra buffering before each stateful operation~\cite{Li:2008:OPN:1453856.1453890}. Our speculative approach requires single buffer per computational pipeline. It is based on the following idea: we can assume that all items are ordered and try to fix the data within the stream if out-of-order items exist. This technique can be efficiently implemented, because any stateful operation can be expressed in the form of the sequence of stateless map and windowed grouping operation, while windowed grouping can be easily implemented in optimistic manner.